test_name: "test Qwen3-235B-A22B-W8A8 disaggregated_prefill"
model: "vllm-ascend/Qwen3-235B-A22B-W8A8"
num_nodes: 2
npu_per_node: 16
env_common:
  HCCL_OP_EXPANSION_MODE: AIV
  VLLM_USE_MODELSCOPE: true
  TASK_QUEUE_ENABLE: 1
  OMP_PROC_BIND: false
  OMP_NUM_THREADS: 1
  HCCL_BUFFSIZE: 1024
  SERVER_PORT: 8080
  DYNAMIC_EPLB: true
disaggregated_prefill:
  enabled: true
  prefiller_host_index: [0]
  decoder_host_index: [1]

deployment:
  -
    server_cmd: >
        vllm serve "vllm-ascend/Qwen3-235B-A22B-W8A8"
        --host 0.0.0.0
        --port $SERVER_PORT
        --data-parallel-size 2
        --data-parallel-size-local 2
        --tensor-parallel-size 8
        --seed 1024
        --enable-expert-parallel
        --max-num-seqs 16
        --max-model-len 8192
        --max-num-batched-tokens 8192
        --quantization ascend
        --trust-remote-code
        --no-enable-prefix-caching
        --gpu-memory-utilization 0.9
        --kv-transfer-config
        '{"kv_connector": "MooncakeConnectorV1",
        "kv_role": "kv_producer",
        "kv_port": "36000",
        "engine_id": "0",
        "kv_connector_extra_config": {
                  "prefill": {
                          "dp_size": 2,
                          "tp_size": 8
                  },
                  "decode": {
                          "dp_size": 2,
                          "tp_size": 8
                  }
            }
        }'
        --additional-config
        '{"eplb_config": {"dynamic_eplb":true,"expert_heat_collection_interval":2048,"algorithm_execution_interval":200}}'

  -
    server_cmd: >
        vllm serve "vllm-ascend/Qwen3-235B-A22B-W8A8"
        --host 0.0.0.0
        --port $SERVER_PORT
        --data-parallel-size 2
        --data-parallel-size-local 2
        --tensor-parallel-size 8
        --seed 1024
        --quantization ascend
        --max-num-seqs 16
        --max-model-len 8192
        --max-num-batched-tokens 8192
        --enable-expert-parallel
        --trust-remote-code
        --no-enable-prefix-caching
        --gpu-memory-utilization 0.9
        --kv-transfer-config
        '{"kv_connector": "MooncakeConnectorV1",
        "kv_role": "kv_consumer",
        "kv_port": "36100",
        "engine_id": "1",
        "kv_connector_extra_config": {
                  "prefill": {
                          "dp_size": 2,
                          "tp_size": 8
                  },
                  "decode": {
                          "dp_size": 2,
                          "tp_size": 8
                  }
            }
        }'
        --additional-config
        '{"eplb_config": {"dynamic_eplb":true,"expert_heat_collection_interval":2048,"algorithm_execution_interval":200}}'
benchmarks:
