test_name: "test Qwen3-235B-A22B multi-dp on A2"
model: "Qwen/Qwen3-235B-A22B"
num_nodes: 2
npu_per_node: 8
env_common:
  VLLM_USE_MODELSCOPE: true
  OMP_PROC_BIND: false
  OMP_NUM_THREADS: 1
  HCCL_BUFFSIZE: 1024
  SERVER_PORT: 8080
  NUMEXPR_MAX_THREADS: 128
  TASK_QUEUE_ENABLE: 1
  PYTORCH_NPU_ALLOC_CONF: expandable_segments:True

deployment:
  -
    server_cmd: >
        vllm serve "Qwen/Qwen3-235B-A22B"
        --host 0.0.0.0
        --port $SERVER_PORT
        --data-parallel-size 2
        --data-parallel-size-local 1
        --data-parallel-address $LOCAL_IP
        --data-parallel-rpc-port 13389
        --tensor-parallel-size 8
        --seed 1024
        --enable-expert-parallel
        --max-num-seqs 128
        --max-model-len 40960
        --max-num-batched-tokens 2048
        --trust-remote-code
        --gpu-memory-utilization 0.9
        --async-scheduling
  -
    server_cmd: >
        vllm serve "Qwen/Qwen3-235B-A22B"
        --headless
        --data-parallel-size 2
        --data-parallel-size-local 1
        --data-parallel-start-rank 1
        --data-parallel-address $MASTER_IP
        --data-parallel-rpc-port 13389
        --tensor-parallel-size 8
        --seed 1024
        --max-num-seqs 128
        --max-model-len 40960
        --max-num-batched-tokens 2048
        --enable-expert-parallel
        --trust-remote-code
        --gpu-memory-utilization 0.9
        --async-scheduling
benchmarks:
  perf:
    case_type: performance
    dataset_path: vllm-ascend/GSM8K-in3500-bs2800
    request_conf: vllm_api_stream_chat
    dataset_conf: gsm8k/gsm8k_gen_0_shot_cot_str_perf
    num_prompts: 2800
    max_out_len: 1500
    batch_size: 256
    request_rate: 4.8
    baseline: 1
    threshold: 0.97
  acc:
    case_type: accuracy
    dataset_path: vllm-ascend/gsm8k-lite
    request_conf: vllm_api_general_chat
    dataset_conf: gsm8k/gsm8k_gen_0_shot_cot_chat_prompt
    max_out_len: 7680
    batch_size: 256
    baseline: 96
    threshold: 5
